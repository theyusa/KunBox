# libbox.aar å†…æ ¸ä¼˜åŒ–æ“ä½œæŒ‡å—

## ğŸ“‹ ä¼˜åŒ–æˆæœ

**ä¼˜åŒ–å®Œæˆæ—¶é—´**: 2026-01-09
**ä¼˜åŒ–æ–¹æ¡ˆ**: ç§»é™¤å¤šä½™æ¶æ„ + llvm-strip

| é¡¹ç›® | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | å‡å°‘ |
|------|--------|--------|------|
| AAR ä½“ç§¯ | 66.36 MB | **15.55 MB** | **76.6%** |
| æ¶æ„æ•°é‡ | 4 ä¸ª | 1 ä¸ª (arm64) | 75% |
| åŠŸèƒ½å®Œæ•´æ€§ | âœ… å®Œæ•´ | âœ… å®Œæ•´ | æ— æŸå¤± |

---

## ğŸš€ å¦‚ä½•ä¼˜åŒ– AAR

### æ–¹æ³•ï¼šä½¿ç”¨ Gradle ä¼˜åŒ–ä»»åŠ¡

```bash
# 1. ç¡®ä¿é…ç½®æ­£ç¡®ï¼ˆå·²é…ç½®å¥½ï¼‰
# gradle.properties ä¸­ skipLibboxStrip=false

# 2. æ‰§è¡Œä¼˜åŒ–ä»»åŠ¡
.\gradlew stripLibboxAar

# 3. åº”ç”¨ä¼˜åŒ–ç»“æœ
cp app\build\stripped-libs\libbox-stripped-*.aar app\libs\libbox.aar
```

**è¯´æ˜**: æ­¤æ–¹æ³•ä¼šä»ç°æœ‰ AAR ä¸­ç§»é™¤ armeabi-v7aã€x86ã€x86_64 æ¶æ„ï¼Œä»…ä¿ç•™ arm64-v8aã€‚

---

## ğŸ”„ å›æ»šåˆ°åŸç‰ˆ

å¦‚æœä¼˜åŒ–åå‡ºç°é—®é¢˜ï¼Œå¯ä»¥å¿«é€Ÿæ¢å¤ï¼š

```bash
# æ¢å¤å¤‡ä»½çš„åŸç‰ˆ AARï¼ˆ66 MBï¼ŒåŒ…å«æ‰€æœ‰æ¶æ„ï¼‰
cp app\libs\libbox.aar.backup_20260109 app\libs\libbox.aar
```

---

## ğŸ› ï¸ ä»æºç é‡æ–°ç¼–è¯‘ï¼ˆå¯é€‰ï¼‰

å¦‚éœ€é‡æ–°ç¼–è¯‘ sing-box å†…æ ¸ï¼š

```bash
# ä½¿ç”¨å®˜æ–¹æ„å»ºè„šæœ¬ï¼ˆå·²é…ç½®ä¸ºä»…æ„å»º arm64ï¼‰
.\buildScript\tasks\build_libbox.ps1
```

**æ³¨æ„**:
- é¦–æ¬¡æ„å»ºéœ€ä¸‹è½½ Go å’Œ sing-box æºç ï¼ˆçº¦ 10-20 åˆ†é’Ÿï¼‰
- éœ€è¦ Android NDK ç¯å¢ƒ
- æ„å»ºåè‡ªåŠ¨è¾“å‡ºåˆ° `app\libs\libbox.aar`

---

## ğŸ“± æµ‹è¯•éªŒè¯

### 1. æ„å»ºæµ‹è¯• APK

```bash
# æ„å»º Debug ç‰ˆæœ¬
.\gradlew assembleDebug

# æŸ¥çœ‹ APK å¤§å°ï¼ˆé¢„æœŸ 35-40 MBï¼‰
ls -lh app\build\outputs\apk\debug\app-arm64-v8a-debug.apk
```

### 2. å®‰è£…æµ‹è¯•

```bash
# å®‰è£…åˆ°è®¾å¤‡
.\gradlew installDebug

# å¯åŠ¨åº”ç”¨
adb shell am start -n com.kunk.singbox/.MainActivity
```

### 3. åŠŸèƒ½æµ‹è¯•æ¸…å•

- [ ] åº”ç”¨æ­£å¸¸å¯åŠ¨
- [ ] å¯¼å…¥è®¢é˜…é“¾æ¥æˆåŠŸ
- [ ] SS/VMess/VLESS/Trojan ç­‰åè®®è¿æ¥æ­£å¸¸
- [ ] å»¶è¿Ÿæµ‹è¯•åŠŸèƒ½æ­£å¸¸
- [ ] è·¯ç”±è§„åˆ™ç”Ÿæ•ˆ
- [ ] é•¿æ—¶é—´è¿è¡Œç¨³å®š

### 4. æŸ¥çœ‹è¿è¡Œæ—¥å¿—

```bash
# ç›‘æ§æ ¸å¿ƒæ—¥å¿—ï¼ˆç¡®ä¿æ— é”™è¯¯ï¼‰
adb logcat -s SingBoxCore:* SingBoxService:*
```

---

## âš™ï¸ é…ç½®æ–‡ä»¶è¯´æ˜

### gradle.properties

```properties
# å…³é”®é…ç½®ï¼šå¯ç”¨ AAR ä¼˜åŒ–
skipLibboxStrip=false

# R8 å…¨æ¨¡å¼æ··æ·†
android.enableR8.fullMode=true
```

### build_libbox.ps1 (è¡Œ 167)

```powershell
# å•æ¶æ„ç¼–è¯‘ï¼ˆå‡å°‘ 75% ä½“ç§¯ï¼‰
go run ./cmd/internal/build_libbox -target android/arm64

# å¦‚éœ€æ”¯æŒè€è®¾å¤‡ï¼Œæ”¹ä¸º:
# go run ./cmd/internal/build_libbox -target android/arm64,android/arm
```

---

## ğŸ“Š è®¾å¤‡å…¼å®¹æ€§

### âœ… æ”¯æŒçš„è®¾å¤‡
- 2019 å¹´åçš„æ‰€æœ‰ Android è®¾å¤‡
- Android 9.0+ å¤§éƒ¨åˆ†è®¾å¤‡
- æ‰€æœ‰ arm64-v8a æ¶æ„è®¾å¤‡
- **è¦†ç›–ç‡**: 99%+ å¸‚åœºä»½é¢

### âŒ ä¸æ”¯æŒçš„è®¾å¤‡
- 2018 å¹´å‰çš„è€æ—§ 32 ä½è®¾å¤‡ (armeabi-v7a)
- x86/x86_64 æ¨¡æ‹Ÿå™¨ï¼ˆè°ƒè¯•æ—¶éœ€å•ç‹¬æ„å»ºï¼‰

**å¦‚éœ€å…¼å®¹è€è®¾å¤‡**: ä¿®æ”¹ `build_libbox.ps1:167` æ·»åŠ  `android/arm` å‚æ•°ã€‚

---

## â“ å¸¸è§é—®é¢˜

### Q1: å®‰è£…æç¤º "INSTALL_FAILED_NO_MATCHING_ABIS"

**åŸå› **: è®¾å¤‡ä¸æ”¯æŒ arm64-v8a æ¶æ„

**è§£å†³**:
```bash
# æ¢å¤åŒ…å«æ‰€æœ‰æ¶æ„çš„åŸç‰ˆ AAR
cp app\libs\libbox.aar.backup_20260109 app\libs\libbox.aar

# æˆ–é‡æ–°æ„å»ºåŒ…å« arm æ¶æ„
# ä¿®æ”¹ build_libbox.ps1:167 æ·»åŠ  android/arm
```

### Q2: ä¼˜åŒ–å AAR ä½“ç§¯æ²¡å˜åŒ–

**åŸå› **: Gradle å¯èƒ½ä½¿ç”¨äº†ç¼“å­˜

**è§£å†³**:
```bash
# æ¸…ç†ç¼“å­˜
.\gradlew clean

# é‡æ–°æ‰§è¡Œä¼˜åŒ–
.\gradlew stripLibboxAar
```

### Q3: æƒ³è¦æ›´å°çš„ä½“ç§¯

**å¯é€‰æ–¹æ¡ˆ**ï¼ˆé£é™©è¾ƒé«˜ï¼‰:
1. **UPX å‹ç¼© .so**: å¯å‡å°‘ 50-70%ï¼Œä½†å¯èƒ½è¢« Google Play æ ‡è®°
2. **è£å‰ªåè®®**: ä¿®æ”¹ sing-box æºç ç§»é™¤ä¸éœ€è¦çš„åè®®

**å»ºè®®**: å½“å‰ 15.55 MB å·²è¶³å¤Ÿå°ï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–æ€§ä»·æ¯”ä¸é«˜ã€‚

---

## ğŸ“‚ é‡è¦æ–‡ä»¶æ¸…å•

```
singboxforandriod/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ libs/
â”‚   â”‚   â”œâ”€â”€ libbox.aar              # ä¼˜åŒ–åçš„ AAR (15.55 MB)
â”‚   â”‚   â””â”€â”€ libbox.aar.backup_*     # åŸç‰ˆå¤‡ä»½ (66.36 MB)
â”‚   â”œâ”€â”€ build.gradle.kts            # Gradle é…ç½®ï¼ˆåŒ…å« strip ä»»åŠ¡ï¼‰
â”‚   â””â”€â”€ proguard-rules.pro          # æ··æ·†è§„åˆ™
â”œâ”€â”€ gradle.properties               # å…¨å±€é…ç½®
â”œâ”€â”€ buildScript/
â”‚   â””â”€â”€ tasks/
â”‚       â””â”€â”€ build_libbox.ps1        # å†…æ ¸æ„å»ºè„šæœ¬
â””â”€â”€ docs/
    â””â”€â”€ LIBBOX-OPTIMIZATION.md      # æœ¬æ–‡æ¡£
```

---

## ğŸ¯ æ ¸å¿ƒè¦ç‚¹

1. **ä¼˜åŒ–æ–¹æ³•**: ä½¿ç”¨ `.\gradlew stripLibboxAar` ç§»é™¤å¤šä½™æ¶æ„
2. **ä½“ç§¯å‡å°‘**: 76.6% (66 MB â†’ 15.55 MB)
3. **åŠŸèƒ½ä¿ç•™**: æ‰€æœ‰åè®®å’Œç‰¹æ€§å®Œæ•´ä¿ç•™
4. **å…¼å®¹æ€§**: è¦†ç›– 99%+ ç°ä»£è®¾å¤‡
5. **å›æ»šæ–¹æ¡ˆ**: ä½¿ç”¨å¤‡ä»½æ–‡ä»¶å¿«é€Ÿæ¢å¤

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

**æ–‡æ¡£ä½ç½®**: `docs/LIBBOX-OPTIMIZATION.md`
**å¤‡ä»½ä½ç½®**: `app/libs/libbox.aar.backup_20260109`
**ä¼˜åŒ–æ—¥æœŸ**: 2026-01-09

---

**æœ€åæ›´æ–°**: 2026-01-09
**é€‚ç”¨ç‰ˆæœ¬**: sing-box v1.12.15
